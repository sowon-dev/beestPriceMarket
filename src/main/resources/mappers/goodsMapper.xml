<?xml version="1.0" encoding="UTF-8"?>
<!-- DTD지정  -->
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="com.bestpricemarket.mappers.goodsMapper">
  
    <!-- 상품등록 -->
	<insert id="register" useGeneratedKeys="true" keyProperty="gno" parameterType="com.bestpricemarket.domain.GoodsVO">
 		insert into goods (category, g_m_id, gname, lowestprice, content, regDate, endDate) 
 		values (#{category},#{g_m_id},#{gname},#{lowestprice},#{content},now(),#{endDate})
	</insert>  
  	<!-- 상품등록 -->
  	  	
  	<!-- 상품목록 -->
  	<select id="listGoods" resultType="com.bestpricemarket.domain.GoodsVO">
  		select * from goods order by gno desc
  	</select> 
  	<!-- 상품목록 -->
  	
  	<!-- 상품조회 -->
  	<select id="detailGoods" resultType="com.bestpricemarket.domain.GoodsVO">
  		select * from goods where gno = #{gno} 
  	</select>  
  	<!-- 상품조회 -->
  		
  	<!-- 상품 수정 -->
  	<update id="modifyGoods">
  		update goods
  		  set
  		  	category = #{category},
  		    gname = #{gname},
  		    content = #{content},
  		    endDate = #{endDate},
  		    lowestprice = #{lowestprice}
  		  where gno = #{gno}  
  	</update>
  	<!-- 상품 수정 -->
  	
  	<!-- 상품 삭제 -->
  	<delete id="deleteGoods">
  		delete from goods
  		where gno = #{gno}
  	</delete>
  	<!-- 상품 삭제 -->
  	
  	<!-- 첨부파일업로드  -->
	 <insert id="insertFile" parameterType="hashmap">
		<![CDATA[
			insert into goodsfile
			 (f_g_gno,f_oname,f_name,f_size,crea_date,update_date) 
			 values(#{gno},#{f_oname},#{f_name},#{f_size},sysdate(),sysdate())
		]]>
	</insert> 
	<!-- 첨부파일업로드  -->
	
	
	<!-- 첨부파일 조회 -->
	<select id="selectFileList" parameterType="int" resultType="hashMap">
		select fno, f_name, f_oname, round(f_size/1024,1) as f_size, del_chk
		from goodsfile
		where f_g_gno = #{gno}
		and del_chk = 'N'
		order by fno asc
	</select>
  	<!-- 파일업로드  -->
  	
  	<!-- 첨부파일업로드 수정 -->
  	 <update id="updateFile" parameterType="hashMap">
  		update goodsfile set del_chk = 'Y' where fno = #{fno}
  	</update> 
  	<!-- 첨부파일업로드 수정 -->
  	
 
  	
  	
  	
  
   <!-- 상품신고 -->
  	<select id="showReportDetail" resultType="com.bestpricemarket.domain.ReportVO">
  		select g.g_m_id, g.gname, g.gno, m.email
  		from goods g
  		join Member m
  		on g.g_m_id = m.id
  		where gno=#{gno}
  	</select>
  	<!-- 상품신고 -->
  	
  	
  	<!-- 좋아요 상품상세페이지로 -->
<!-- <update id="like_check">
update goods
set like = like + 1
where gno = {#gno}  	
  	
</update>  -->


<select id="countbyLike" resultType="int" parameterType="HashMap">
   SELECT COUNT(lno) as cnt
   FROM likes
   where l_m_id = #{l_m_id}   <!-- 누가불렀는지  -->
  </select>

  <insert id="create" parameterType="HashMap">
    INSERT INTO likes(l_g_gno, l_m_id, l_m_actionstatus) 
    values (#{gno},#{g_m_id},#{l_m_actionstatus})  <!-- g_m_id 다시 확인 -->
  </insert>
    
  <update id="goods_update" parameterType="int">
    UPDATE goods
    SET `like` = `like` + 1 
    WHERE gno = #{gno}  <!-- l_m_id 맞는지 확인 -->
  </update>
  
  <update id="like_check_cancel" parameterType="HashMap">
    UPDATE likes
    SET l_m_actionstatus = 0
    WHERE l_m_id=#{l_m_id} AND gno=#{gno}  <!-- l_m_id 맞는지 확인 -->
  </update>
  
  <select id="read" resultType="LikesVO" parameterType="HashMap">
    SELECT lno, l_g_gno, l_m_id, l_m_actionstatus 
    FROM likes 
    WHERE gno=#{gno} AND l_m_id=#{l_m_id} <!-- 필요...??? -->
  </select>
  
  <delete id="deletebyGno" parameterType="int">
    DELETE FROM likes
    WHERE gno=#{gno}
  </delete>
  
  <delete id="deletebyL_m_id" parameterType="int">
    DELETE FROM likes
    WHERE l_m_id=#{l_m_id}
  </delete>
  	
  	
  	
  	

  
  
  
  </mapper>